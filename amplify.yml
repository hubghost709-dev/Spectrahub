version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm install
        # Verifica variables de entorno esenciales
        - echo "Clerk Key: $NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY"
        - echo "Database URL: $DATABASE_URL"
    build:
      commands:
        # Generar Prisma Client antes del build
        - npx prisma generate
        # Compilar Next.js
        - npm run build
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - .next/cache/**/*

  customHeaders:
    - pattern: '**/*'
      headers:
        - key: 'Cache-Control'
          value: 'max-age=31536000,public'
    - pattern: '**/*.html'
      headers:
        - key: 'Cache-Control'
          value: 'no-cache'

env:
  NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY: ${NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY}
  CLERK_SECRET_KEY: ${CLERK_SECRET_KEY}
  NEXT_PUBLIC_CLERK_SIGN_IN_URL: ${NEXT_PUBLIC_CLERK_SIGN_IN_URL}
  NEXT_PUBLIC_CLERK_SIGN_UP_URL: ${NEXT_PUBLIC_CLERK_SIGN_UP_URL}
  NEXT_PUBLIC_CLERK_AFTER_SIGN_IN_URL: ${NEXT_PUBLIC_CLERK_AFTER_SIGN_IN_URL}
  NEXT_PUBLIC_CLERK_AFTER_SIGN_UP_URL: ${NEXT_PUBLIC_CLERK_AFTER_SIGN_UP_URL}
  CLERK_WEBHOOK_SECRET: ${CLERK_WEBHOOK_SECRET}

  DATABASE_URL: ${DATABASE_URL}

  LIVEKIT_API_URL: ${LIVEKIT_API_URL}
  LIVEKIT_API_KEY: ${LIVEKIT_API_KEY}
  LIVEKIT_API_SECRET: ${LIVEKIT_API_SECRET}
  NEXT_PUBLIC_LIVEKIT_WS_URL: ${NEXT_PUBLIC_LIVEKIT_WS_URL}

  STRIPE_SECRET_KEY: ${STRIPE_SECRET_KEY}

  PAYPAL_CLIENT_ID: ${PAYPAL_CLIENT_ID}
  PAYPAL_CLIENT_SECRET: ${PAYPAL_CLIENT_SECRET}
  NEXT_PUBLIC_PAYPAL_CLIENT_ID: ${NEXT_PUBLIC_PAYPAL_CLIENT_ID}

  UPLOADTHING_SECRET: ${UPLOADTHING_SECRET}
  UPLOADTHING_APP_ID: ${UPLOADTHING_APP_ID}

  LOVENSE_TOKEN: ${LOVENSE_TOKEN}
  LOVENSE_KEY: ${LOVENSE_KEY}
  LOVENSE_IV: ${LOVENSE_IV}

  NODE_ENV: production
  NEXT_TELEMETRY_DISABLED: 1

